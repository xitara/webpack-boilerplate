/**
 * called with initTestimonialsSlider(
 *      testimonials, -> array of objects with comment, date, name, stars
 *      selector, -> css selector of the element after which the slider should be inserted
 *      number -> number of reviews to show (optional - default 0 -> all)
 * )
 */

import { qs, rand } from './utils';
import { tns } from 'tiny-slider/src/tiny-slider.js';

const testimonial = (comment: string, date: string, name: string, stars: number): string => {
    const url = 'https://extern.conversion.consulting/cdn';
    return `<aside class="review-item" style="--sl-stars: ${stars}">
        <div class="review-item-inner">
            <div class="review-item-stars-gray">
                <img src="${url}/5-stars_gray.png">
            </div>
            <div class="review-item-stars-gold">
                <img src="${url}/5-stars_gold.png">
            </div>
            <span class="review-item-date">${date}</span>
            |
            <span class="review-item-name">${name}</span>
            <span class="review-item-verified">
                <svg viewBox="0 0 71.933578 71.922363" version="1.1">
                    <path d="m 25.404648,67.604278 c -2.11367,-8.17638 -2.30096,-8.88941 -2.34712,-8.93557 -0.0479,-0.0478 -1.68209,0.41642 -11.71097,3.32699 -1.26235,0.36636 -1.5406503,0.42351 -1.5072703,0.30956 0.4127303,-1.40932 3.6172403,-13.15234 3.5948303,-13.17339 -0.0173,-0.0162 -3.01268,-0.76585 -6.6565203,-1.66589 -3.64385,-0.90005 -6.62517,-1.6596 -6.62517,-1.68791 0,-0.0283 2.16691,-2.18202 4.81535,-4.78602 2.64844,-2.604 4.83549,-4.77567 4.86012,-4.82592 0.0246,-0.0503 -0.68495,-0.79114 -1.57685,-1.64642 -1.72803,-1.6571 -5.08817,-4.88881 -7.04029,-6.771211 -0.65193,-0.62865 -1.19629,-1.16636 -1.20969,-1.1949 -0.0134,-0.0285 0.10091,-0.0748 0.254,-0.10281 0.45249,-0.0827 12.9557003,-3.350406 13.0037803,-3.398487 0.0404,-0.04039 -0.40294,-1.60637 -2.89576,-10.228586 C 9.6795677,10.459513 9.5174877,9.803533 9.6247077,9.8353 c 1.1740203,0.34782 13.1496703,3.615489 13.1686003,3.593176 0.0246,-0.02899 1.11302,-4.39371 2.64159,-10.593146 0.36455,-1.478491 0.68594,-2.68816602 0.71421,-2.68816602 0.0283,0 2.20111,2.18632602 4.82853,4.85850202 2.62742,2.672177 4.80418,4.853402 4.83726,4.847167 0.0331,-0.0062 1.2495,-1.249586 2.70318,-2.763003 4.74642,-4.941458 6.80085,-7.06931502 6.84515,-7.089783018215 C 45.387128,-0.01101302 45.911408,1.932083 46.528208,4.318047 c 2.11508,8.181847 2.30097,8.889423 2.34762,8.936078 0.0257,0.02571 0.87494,-0.192931 1.88718,-0.485874 1.01223,-0.292944 3.28822,-0.95098 5.05775,-1.462303 1.76953,-0.511324 3.91403,-1.131944 4.76554,-1.379157 1.26224,-0.366458 1.54064,-0.423664 1.50727,-0.309719 -0.0225,0.07687 -0.56059,2.025708 -1.19574,4.330758 -0.63514,2.30505 -1.43723,5.213362 -1.78243,6.462916 -0.3452,1.249554 -0.62764,2.299211 -0.62764,2.332572 0,0.03336 2.99085,0.801004 6.64633,1.705873 3.65549,0.904869 6.64634,1.668016 6.64634,1.695876 0,0.0279 -2.16691,2.181211 -4.81535,4.785211 -2.64844,2.604 -4.83549,4.77567 -4.86012,4.82592 -0.0246,0.0503 0.68495,0.79114 1.57684,1.64642 1.72804,1.6571 5.08818,4.88881 7.04029,6.77121 0.65194,0.62865 1.19652,1.16701 1.21018,1.19635 0.0137,0.0294 -0.0816,0.0709 -0.21167,0.0925 -0.36932,0.0611 -13.00236,3.36315 -13.05038,3.41118 -0.0446,0.0446 0.0304,0.31002 2.34541,8.29635 0.78289,2.70086 1.41763,4.91961 1.41052,4.93054 -0.007,0.0109 -2.97677,-0.79869 -6.59924,-1.79917 -3.62247,-1.00047 -6.61581,-1.81904 -6.65186,-1.81904 -0.0361,0 -0.083,0.0857 -0.10424,0.1905 -0.10229,0.50359 -3.22663,13.06518 -3.25856,13.1012 -0.0202,0.0228 -1.03174,-0.96785 -2.24794,-2.20134 -1.2162,-1.23348 -3.39373,-3.43378 -4.83895,-4.88954 l -2.62767,-2.64685 -0.34951,0.36085 c -0.19223,0.19846 -1.81244,1.8846 -3.60046,3.74696 -4.72273,4.91906 -5.53036,5.75558 -5.57846,5.778 -0.0237,0.0111 -0.54781,-1.93203 -1.16461,-4.318 z m 8.12854,-20.26437 c 0.58521,-0.2044 1.05478,-0.61435 1.80575,-1.57648 11.55086,-14.79872 13.25581,-17.00673 13.43912,-17.40441 0.14558,-0.315851 0.18381,-0.557441 0.18367,-1.160851 -1.9e-4,-0.79343 -0.10767,-1.12023 -0.57741,-1.755575 -0.28053,-0.379441 -0.98689,-0.811083 -1.56899,-0.958775 -0.9502,-0.241086 -1.9715,0.07639 -2.69843,0.838802 -0.18435,0.193349 -1.21028,1.475498 -2.27985,2.849208 -1.06957,1.373721 -3.63471,4.669371 -5.7003,7.323671 -2.06559,2.6543 -3.76865,4.84245 -3.78458,4.86255 -0.0159,0.0201 -1.12375,-1.04977 -2.46185,-2.37749 -2.55559,-2.53579 -2.759,-2.69508 -3.65966,-2.86589 -1.11854,-0.21213 -2.46527,0.46078 -2.98802,1.49298 -0.21855,0.43154 -0.33648,1.11479 -0.27598,1.599 0.12354,0.9888 0.24992,1.14126 4.25464,5.13243 2.45071,2.44241 3.8306,3.75662 4.07073,3.87697 0.66021,0.33088 1.51342,0.37804 2.24116,0.12386 z" id="path1" />
                </svg>
                <span>Verifizierte Bewertung von <a href="https://www.trustedshops.de/bewertung/info_XD919BEE2005B296BBAFC3B1BAA06C457.html">trustedshops.com</a></span>
            </span>
            <div class="review-item-body">${comment}</div>
        </div>
    </aside>`;
};

export const initTestimonialsSlider = (
    testimonials: { comment: string; date: string; name: string; stars: number }[] = [],
    selector: string | null = null,
    number = 0,
    random = false,
    id: string = 'new-review-slider'
) => {
    if (!testimonials.length) return;
    if (!selector) return;
    if (number === 0) number = testimonials.length;

    qs(selector).insertAdjacentHTML('afterbegin', '<div id="' + id + '"></div>');

    let data;
    let el = qs('#' + id);

    for (let i = 0; i < number; i++) {
        if (random) {
            data = testimonials[rand(0, testimonials.length - 1)];
        } else {
            data = testimonials[i];
        }
        let html = testimonial(data.comment, data.date, data.name, data.stars);

        el.insertAdjacentHTML('afterbegin', html);
    }

    const slider = tns({
        container: '#' + id,
        items: 5,
        slideBy: 2,
        // autoplay: false,
        autoplay: true,
        // gutter: 15,
        // controls: false,
        controls: true,
        controlsText: ['&lsaquo;', '&rsaquo;'],
        nav: false,
        center: true,
        responsive: {
            0: {
                items: 1,
            },
            640: {
                items: 2,
            },
            900: {
                items: 3,
            },
            1200: {
                items: 4,
            },
            1600: {
                items: 5,
            },
        },
    });

    return slider;
};
